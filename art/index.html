<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Art</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="icon" href="../assets/images/favicon.png">
</head>
<body>
    <a class="skip-link" href="#main">Skip to main content</a>
    <nav>
        <a href="../index.html">Home</a>
    </nav>
    <main id="main">
        <h1>Art Portfolio</h1>
        <p>Gallery and information about artistic projects.</p>
        <div id="gallery" class="gallery"></div>
        <noscript>Please enable JavaScript to view the gallery.</noscript>
    </main>
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        Promise.all([
            fetch('images.json').then(r => r.json()),
            fetch('captions.json').then(r => r.json()).catch(() => ({}))
        ])
            .then(([images, captions]) => {
                const gallery = document.getElementById('gallery');
                const wrappers = [];
                let loaded = 0;

                const formatCaption = name =>
                    name.replace(/\.[^/.]+$/, '')
                        .replace(/[-_]+/g, ' ')
                        .replace(/\d+/g, ' ')
                        .replace(/\s+/g, ' ')
                        .trim();

                const checkDone = () => {
                    if (loaded === wrappers.length) {
                        wrappers
                            .sort((a, b) => a.img.naturalHeight - b.img.naturalHeight)
                            .forEach(w => gallery.appendChild(w.figure));
                    }
                };

                images.forEach(name => {
                    const figure = document.createElement('figure');
                    const img = new Image();
                    const caption = document.createElement('figcaption');

                    const desc = captions[name] || formatCaption(name);

                    img.src = `images/${name}`;
                    img.alt = desc;
                    caption.textContent = desc;

                    img.addEventListener('load', () => {
                        loaded++;
                        checkDone();
                    });

                    figure.appendChild(img);
                    figure.appendChild(caption);
                    wrappers.push({ figure, img });
                });

                checkDone();
            })
            .catch(err => console.error('Could not load gallery', err));
    });
    </script>
    <script src="../js/main.js"></script>
</body>
</html>
